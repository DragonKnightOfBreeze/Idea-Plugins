# 概述

Stellaris模组编程支持。

目前仍在烧脑更新中......

［注意］

更多中文和英文信息，请参见[plugin.xml](https://github.com/DragonKnightOfBreeze/Idea-Plugins/blob/master/stellaris-modding-support/src/main/resources/META-INF/plugin.xml)

For more Chinese and English information, please see [plugin.xml](https://github.com/DragonKnightOfBreeze/Idea-Plugins/blob/master/stellaris-modding-support/src/main/resources/META-INF/plugin.xml)

# 功能

## Global

* [ ] 设置
  * [X] 是否解析内部引用
  * [ ] 是否解析外部引用
* [X] 文件类型重载（仅识别游戏或模组目录下的脚本文件和本地化文件）

## Stellaris Localization Language

对Stellaris本地化语言的支持。

* [X] 语言和文件类型
* [X] 语法和词法解析
  * [X] 基本语法
  * [X] 语言区域 `l_english`
  * [X] 属性 `KEY:0 "Value."`
  * [X] 属性引用 `$REFERENCE$` & 带参数的
  * [X] 图标 `£icon£` & 带参数的
  * [X] 编号 `%O%`
  * [X] 代码 `[CODE]`
  * [X] 彩色文本 `§RText§`
* [X] 语法高亮
* [X] 代码折叠
  * [X] 单行注释 -> `#...`
* [X] 括号适配器
  * [X] `[...]` `"..."` `$...$` 等
* [X] 颜色风格设置
* [X] 注释器
* [X] 拼写检查器
* [X] 代码补全
  * [X] 语言区域（如：`l_english`）
* [X] 动态模版
  * [X] 属性引用
  * [X] 代码
  * [X] 图标
  * [X] 编号
  * [X] 彩色文本
* [X] 面包屑导航
* [X] 结构视图
* [X] 引用
  * [X] 属性引用
* [X] 代码重构
  * [X] 重命名属性
  * [X] 重命名属性的合法性检查
  * [X] 安全删除属性
* [X] 代码格式设置
* [X] 格式化
* [X] 提供文档注释
  * [X] 属性（位置，名称，解析后的注释文本，渲染后的文本）
  * [X] 语言区域、颜色、图标等（名称，描述）
* [X] 提供描述（查找使用时要用到）
* [X] 定位定义
  * [X] 属性 -> 同一文件中的属性定义
  * [X] 属性 -> 项目文件中的属性定义
* [X] 定位使用
  * [X] 属性 -> 属性引用，脚本文件的属性值 ？
* [X] 注解器
  * [X] 突出将颜色文本的颜色代码，渲染为对应的颜色
  * [X] 突出不支持的语言区域/编号等，显示错误信息，提供快速修正
  * [X] 标出图标，点击可以导航到所有同名的属性
* [X] 意向 Intention
  * [X] 更改语言区域
  * [X] 更改颜色
  * [X] 更改编号
* [X] 代码检查 Inspection
  * [X] ［错误］重复的属性 → 导航到重复的属性
  * [X] ［错误］不支持的语言区域 → 选择语言区域（语法上允许其他语言区域）
  * [X] ［警告］非法的文件编码 → 转化为正确的文件编码（必须是`UTF-8 BOM`）
  * [X] ~~［警告］非法的文件名 （必须包含语言区域字符串如`l_simp_chinese`）~~

## Stellaris Script Language

对Stellaris脚本语言的支持。

* [X] 语言和文件类型
* [X] 语法和词法解析
  * [X] 基本语法
  * [X] 属性 `key = value`
  * [X] 变量 `@var = 1`
  * [X] 变量引用 `@var`
  * [X] 布尔值 `yes` / `no`
  * [X] 数值 `1`
  * [X] 字符串 `string` / `"string"`
  * [X] 对象和数组 `{...}`
  * [X] 颜色 `rgb {255 255 255}`
  * [X] 代码 `@\[...]`
* [X] 语法高亮
* [X] 代码折叠
  * [X] 列表 -> `{...}`
  * [X] 单行注释 -> `#...`
* [X] 括号适配器
  * [X] `{...}` `"..."`
* [X] 颜色风格设置
* [X] 注释器
* [X] 颜色提供器
  * [X] 为颜色类型的值显示正确的颜色图标
* [X] 拼写检查器
* [X] 代码补全
  * [X] 关键字 `yes`/`no`
* [X] 动态模版
  * [X] 来自本地化文件的动态模版
* [X] 面包屑导航
* [X] 结构视图
* [X] 引用
  * [X] 变量引用
  * [X] 属性引用
* [X] 代码重构
  * [X] 重命名变量
  * [X] 重命名变量的合法性检查
  * [X] 安全删除变量
  * [ ] 内联变量
* [X] 代码格式设置
* [X] 格式化
* [X] 提供文档注释
  * [X] 变量（位置，名称，解析后的注释文本）
  * [X] 属性（位置，名称，解析后的注释文本，渲染后的文本、描述文本、标签文本）
* [X] 提供描述（查找使用时要用到）
* [X] 定位定义
  * [X] 变量引用 -> 变量定义
  * [X] 字符串 -> 可能的脚本文件的属性
  * [X] 字符串 -> 可能的本地化文件的属性
* [X] 定位使用
  * [X] 变量 -> 属性值
* [X] 注解器
  * [X] 对于颜色类型，在页面左侧显示对应颜色的图标，并且可以点击图标更改颜色
  * [X] 标出图标，点击可以导航到所有同名的属性
  * [X] 提示属性的相关的本地化属性
  * [X] 提示属性的值对应的本地化属性/脚本属性
* [X] 意向 Intention
* [X] 代码检查 Inspection
  * [X] ［错误］重复的变量定义 → 导航到重复的变量定义
  * [X] ［警告］非法的文件编码 → 转化为正确的文件编码（除了name_list是`UTF-8 BOM`之外，必须是`UTF-8 NO BOM`）

## Stellaris Script Schema

基于Json Schema对Stellaris脚本进行验证。

* [X] 代码提示
* [X] 定位定义
* [X] 代码检查
* [ ] 文档注释
* [ ] 提供较为完善的Schema规则
* [X] 为特定位置的脚本文件绑定对应的Schema规则
* [ ] 实现特殊的Schema规则（如将字符串解析为路径、模组路径）

# 注意事项

* 只有在包含`descriptor.mod`或者`stellaris.exe`的目录下的文件才有可能被识别为Stellaris的本地化文件和脚本文件
* 本地化文件的属性值中的双引号可以不转义
* 本地化文件的行尾注释不能包含双引号，否则会造成语法解析冲突
* 通过快速修正更改了文件编码和BOM之后，必须真正编辑文件内容才会进行下一次检查，让上方的警告消失
* 查询引用（如变量和属性）基于名称和语言区域，而不基于类型（如建筑和人口职业），因此标注的引用可能不正确
* 属性的文档注释中会渲染相关的本地化文本，其中图标会爬取wiki上的对应图片进行渲染
