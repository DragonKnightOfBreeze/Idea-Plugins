cara_generate_deal1 = {
	if = {
		# repeat existing price for 1 year, otherwise refresh flag
		limit = {
			NOR = {
				has_country_flag = fleet1dealcost1
				has_country_flag = fleet1dealcost2
				has_country_flag = fleet1dealcost3
				has_country_flag = fleet1dealcost4
				has_country_flag = fleet1dealcost5
				has_country_flag = fleet1dealcost6
			}
		}
		random_list = {
			1 = {
				modifier = {
					factor = 0
					has_ethic = ethic_gestalt_consciousness
				}
				set_timed_country_flag = { flag = fleet1dealcost1 days = @fleet1dealdecay }
			}
			1 = { set_timed_country_flag = { flag = fleet1dealcost2 days = @fleet1dealdecay } }
			1 = { set_timed_country_flag = { flag = fleet1dealcost3 days = @fleet1dealdecay } }
			1 = {
				modifier = {
					factor = 0
					has_modifier = 6monthsocietycost
				}
				set_timed_country_flag = { flag = fleet1dealcost4 days = @fleet1dealdecay }
			}
			1 = { set_timed_country_flag = { flag = fleet1dealcost5 days = @fleet1dealdecay } }
			0 = {
				modifier = {
					add = 1
					has_ethic = ethic_gestalt_consciousness
				}
				set_timed_country_flag = { flag = fleet1dealcost6 days = @fleet1dealdecay }
			}
		}
	}
	# PRODUCT
	if = {
		# repeat existing product for 1 year, otherwise refresh flag
		limit = {
			NOR = {
				has_country_flag = fleet1dealproduct1
				has_country_flag = fleet1dealproduct2
				has_country_flag = fleet1dealproduct3
				has_country_flag = fleet1dealproduct4
				has_country_flag = fleet1dealproduct5
				has_country_flag = fleet1dealproduct6 # Spawning Pool Stimulants
				has_country_flag = fleet1dealproduct7 # Energy
			}
		}

		random_list = {

			# Bunk beds
			1 = {
				modifier = {
					factor = 0.1
					OR = {
						has_country_flag = bunkbeds_ready
						any_owned_planet = { has_modifier = bunkbeds_deployed }
					}
				}
				modifier = {
					factor = 0
					is_regular_empire = no
				}
				set_timed_country_flag = { flag = fleet1dealproduct1 days = @fleet1dealdecay }
			}

			# Tupperware
			1 = { 
				modifier = {
					factor = 0.1
					OR = {
						has_country_flag = tupperware_ready
						any_owned_planet = { has_modifier = tupperware_deployed }
					}
				}
				modifier = {
					factor = 0
					is_regular_empire = no
				}
				set_timed_country_flag = { flag = fleet1dealproduct2 days = @fleet1dealdecay }
			}

			# Atmospheric Deodorizer
			1 = {
				modifier = {
					factor = 0.1
					OR = {
						has_country_flag = atmospheric_deodorizer_ready
						any_owned_planet = { has_modifier = atmospheric_deodorizer_deployed }
					}
				}
				modifier = {
					factor = 0
					is_gestalt = yes
				}
				set_timed_country_flag = { flag = fleet1dealproduct3 days = @fleet1dealdecay }
			}

			# Consumer Goods
			1 = {
				modifier = {
					factor = 0
					has_authority = auth_machine_intelligence
					NOT = { has_civic = civic_machine_servitor }
				}
				set_timed_country_flag = { flag = fleet1dealproduct4 days = @fleet1dealdecay }
			}
			1 = {
				modifier = {
					factor = 0
					OR = {
						is_gestalt = yes
						has_modifier = vengralian_sales_contingent
					}
				}
				set_timed_country_flag = { flag = fleet1dealproduct5 days = @fleet1dealdecay }
			}

			# Spawn Pool Stimulants
			0 = {
				modifier = {
					add = 1
					has_authority = auth_hive_mind
				}
				modifier = {
					factor = 0
					has_modifier = spawn_pool_stimulants
				}
				set_timed_country_flag = { flag = fleet1dealproduct6 days = @fleet1dealdecay }
			}

			# Energy
			0 = {
				modifier = {
					add = 1
					has_ethic = ethic_gestalt_consciousness
				}
				modifier = {
					factor = 100
					has_ethic = ethic_gestalt_consciousness
					has_country_flag = fleet1dealcost6
				}
				set_timed_country_flag = { flag = fleet1dealproduct7 days = @fleet1dealdecay }
			}
		}
	}
}
